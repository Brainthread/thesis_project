[gd_resource type="Compositor" load_steps=3 format=3 uid="uid://r76ikc2vw5qd"]

[ext_resource type="Script" uid="uid://bqxthc3qbnr0n" path="res://Scripts/PostProcessing/PS1OverlayShader.gd" id="1_n8lbn"]

[sub_resource type="CompositorEffect" id="CompositorEffect_qqebx"]
resource_local_to_scene = false
resource_name = ""
enabled = true
effect_callback_type = 4
needs_motion_vectors = false
needs_normal_roughness = false
script = ExtResource("1_n8lbn")
shader_code = "const int pixel_size = scale;
const ivec2 pixel_step = ivec2(pixel_size, pixel_size);
const float dither_gamma = 10;

ivec2 base_uv = (uv / pixel_step) * pixel_step;

color = imageLoad(color_image, base_uv);
ivec2 base_block = ivec2(floor(uv / pixel_step));
int idx = (base_block.x % 4) + (base_block.y % 4) * pixel_size;


vec3 c = color.rgb;
vec3 srgb = pow(max(c, 0.0), vec3(1.0 / 2.2));
float steps = pow(2.0, color_depth) - 1.0;
vec3 quantized = floor(srgb * steps + 0.5) / steps;
c = pow(quantized, vec3(2.2));

color = vec4(c.r, c.g, c.b, 1);"
metadata/_custom_type_script = "uid://bqxthc3qbnr0n"

[resource]
compositor_effects = Array[CompositorEffect]([SubResource("CompositorEffect_qqebx")])
